
<main class="min-h-screen app-bg-main font-sans p-3 sm:p-6 lg:p-8 flex flex-col h-[100dvh] transition-colors duration-300">
  <div class="max-w-screen-2xl mx-auto w-full h-full flex flex-col">
    
    <!-- Header -->
    <header class="flex justify-between items-center mb-4 sm:mb-8 shrink-0 relative">
      <div class="w-10 lg:w-0"></div> <!-- Spacer for centering -->
      
      <div class="text-center">
        <h1 class="text-2xl sm:text-4xl lg:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[var(--accent-secondary)] to-[var(--accent-primary)] truncate">
          Mermaid Generator
        </h1>
        <p class="hidden sm:block mt-2 text-lg app-text-muted">Instantly visualize your Mermaid diagrams.</p>
      </div>

      <button (click)="store.isSettingsModalOpen.set(true)" class="p-2 app-text-muted hover:text-[var(--text-main)] hover:bg-[var(--bg-secondary)] rounded-lg transition-all" title="Settings">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
      </button>
    </header>

    <!-- Mobile View Switcher (Visible only on LG and below) -->
    <div class="lg:hidden flex app-bg-secondary p-1 rounded-lg mb-4 shrink-0 mx-auto w-full max-w-md border app-border">
      <button 
        (click)="store.setMobileTab('editor')"
        class="flex-1 py-2 text-sm font-medium rounded-md transition-all duration-200 flex items-center justify-center gap-2"
        [class]="store.mobileTab() === 'editor' ? 'bg-[var(--accent-primary)] text-white shadow-sm' : 'app-text-muted hover:text-[var(--text-main)]'"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
        Editor
      </button>
      <button 
        (click)="store.setMobileTab('preview')"
        class="flex-1 py-2 text-sm font-medium rounded-md transition-all duration-200 flex items-center justify-center gap-2"
        [class]="store.mobileTab() === 'preview' ? 'bg-[var(--accent-primary)] text-white shadow-sm' : 'app-text-muted hover:text-[var(--text-main)]'"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        Preview
      </button>
    </div>

    <!-- Main Content Area -->
    <div class="flex-grow min-h-0 relative lg:grid lg:grid-cols-2 lg:gap-8">
      
      <!-- Editor Column -->
      <div 
        class="flex flex-col h-full lg:h-[calc(100vh-14rem)] absolute inset-0 lg:relative lg:block transition-opacity duration-300"
        [class.z-10]="store.mobileTab() === 'editor'"
        [class.opacity-100]="store.mobileTab() === 'editor'"
        [class.opacity-0]="store.mobileTab() !== 'editor'"
        [class.pointer-events-none]="store.mobileTab() !== 'editor' && !isLargeScreen"
        [class.lg:opacity-100]="true"
        [class.lg:pointer-events-auto]="true"
      >
        <app-code-editor 
          [code]="store.mermaidCode()" 
          (codeChange)="store.setCode($event)"
        >
          <div actions class="flex gap-2">
            <!-- Mobile: Condensed Buttons -->
             <button (click)="store.openAiModal('refine')" [disabled]="!store.mermaidCode().trim()" class="text-xs bg-amber-600 hover:bg-amber-500 disabled:bg-amber-600/50 disabled:cursor-not-allowed text-white transition-colors px-2 sm:px-3 py-1.5 rounded-md flex items-center gap-1.5 border border-amber-500/50 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
              <span class="hidden sm:inline">Refine</span>
            </button>
            
            <button (click)="store.openAiModal('generate')" class="text-xs bg-indigo-600 hover:bg-indigo-500 text-white transition-colors px-2 sm:px-3 py-1.5 rounded-md flex items-center gap-1.5 border border-indigo-500/50 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></svg>
              <span class="hidden sm:inline">AI Generate</span>
              <span class="sm:hidden">AI</span>
            </button>
            
            <button (click)="store.isExampleModalOpen.set(true)" class="text-xs app-btn transition-colors px-2 sm:px-3 py-1.5 rounded-md flex items-center gap-1.5 border app-border">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
              <span class="hidden sm:inline">Examples</span>
            </button>

            <div class="w-px bg-[var(--border-color)] mx-1"></div>

            <button (click)="store.addToHistory()" class="text-xs app-btn transition-colors px-2 sm:px-3 py-1.5 rounded-md flex items-center gap-1.5 border app-border" title="Save to History">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
              <span class="hidden sm:inline">Save</span>
            </button>

            <button (click)="store.isHistoryModalOpen.set(true)" class="text-xs app-btn transition-colors px-2 sm:px-3 py-1.5 rounded-md flex items-center gap-1.5 border app-border" title="View History">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
              <span class="hidden sm:inline">History</span>
            </button>
          </div>
        </app-code-editor>
      </div>

      <!-- Preview Column -->
      <div 
        class="flex flex-col h-full lg:h-[calc(100vh-14rem)] absolute inset-0 lg:relative lg:block transition-opacity duration-300"
        [class.z-10]="store.mobileTab() === 'preview'"
        [class.opacity-100]="store.mobileTab() === 'preview'"
        [class.opacity-0]="store.mobileTab() !== 'preview'"
        [class.pointer-events-none]="store.mobileTab() !== 'preview' && !isLargeScreen"
        [class.lg:opacity-100]="true"
        [class.lg:pointer-events-auto]="true"
      >
        <app-chart-preview 
          #preview
          [code]="store.mermaidCode()"
          [theme]="store.theme()"
          (onRenderStart)="store.isRendering.set(true)"
          (onRenderEnd)="store.isRendering.set(false)"
          (onRenderError)="store.renderError.set($event)"
        >
          <app-toolbar 
            controls 
            [themes]="store.themes" 
            [selectedTheme]="store.theme()" 
            [isRendering]="store.isRendering()"
            [disabledExport]="!!store.renderError() || !store.mermaidCode().trim()"
            (themeChange)="store.setTheme($event)"
            (openExport)="store.isExportModalOpen.set(true)"
          ></app-toolbar>
        </app-chart-preview>
      </div>
    </div>

    <footer class="text-center mt-4 text-slate-500 text-xs sm:text-sm shrink-0 hidden lg:block">
      <p>Powered by Angular & Mermaid.js</p>
    </footer>
  </div>

  <!-- Modals -->
  <app-ai-modal 
    [isOpen]="store.isAiModalOpen()"
    [mode]="store.aiModalMode()"
    [currentCode]="store.mermaidCode()"
    (close)="store.isAiModalOpen.set(false)"
    (codeGenerated)="handleAiCode($event)"
  ></app-ai-modal>

  <app-example-modal
    [isOpen]="store.isExampleModalOpen()"
    [examples]="chartExamples"
    (close)="store.isExampleModalOpen.set(false)"
    (select)="handleExampleLoad($event)"
  ></app-example-modal>

  <app-export-modal
    [isOpen]="store.isExportModalOpen()"
    (close)="store.isExportModalOpen.set(false)"
    (confirm)="handleExport($event)"
  ></app-export-modal>

  <app-settings-modal
    [isOpen]="store.isSettingsModalOpen()"
    (close)="store.isSettingsModalOpen.set(false)"
  ></app-settings-modal>

  <app-history-modal
    [isOpen]="store.isHistoryModalOpen()"
    [history]="store.history()"
    (close)="store.isHistoryModalOpen.set(false)"
    (load)="handleHistoryLoad($event)"
    (delete)="store.deleteFromHistory($event)"
  ></app-history-modal>
</main>
