
<main class="min-h-screen bg-slate-900 text-slate-200 font-sans p-4 sm:p-6 lg:p-8">
  <div class="max-w-screen-2xl mx-auto h-full flex flex-col">
    <header class="text-center mb-8 shrink-0">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-emerald-500">
        Mermaid Chart Generator
      </h1>
      <p class="mt-2 text-lg text-slate-400">Instantly visualize your Mermaid diagrams.</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 flex-grow">
      
      <!-- Editor Column -->
      <div class="flex flex-col h-[70vh] lg:h-[calc(100vh-14rem)]">
        <app-code-editor 
          [code]="store.mermaidCode()" 
          (codeChange)="store.setCode($event)"
        >
          <div actions class="flex gap-2">
            <!-- Refine Button -->
             <button (click)="store.openAiModal('refine')" [disabled]="!store.mermaidCode().trim()" class="text-xs bg-amber-600 hover:bg-amber-500 disabled:bg-amber-600/50 disabled:cursor-not-allowed text-white transition-colors px-3 py-1 rounded-md flex items-center gap-1.5 border border-amber-500/50 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
              Refine
            </button>
            
            <!-- Generate Button -->
            <button (click)="store.openAiModal('generate')" class="text-xs bg-indigo-600 hover:bg-indigo-500 text-white transition-colors px-3 py-1 rounded-md flex items-center gap-1.5 border border-indigo-500/50 shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></svg>
              AI Generate
            </button>
            
            <!-- Examples Button -->
            <button (click)="store.isExampleModalOpen.set(true)" class="text-xs bg-slate-700 hover:bg-slate-600 transition-colors px-3 py-1 rounded-md flex items-center gap-1.5 border border-slate-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
              Examples
            </button>
          </div>
        </app-code-editor>
      </div>

      <!-- Preview Column -->
      <div class="flex flex-col h-[70vh] lg:h-[calc(100vh-14rem)]">
        <app-chart-preview 
          #preview
          [code]="store.mermaidCode()"
          [theme]="store.theme()"
          (onRenderStart)="store.isRendering.set(true)"
          (onRenderEnd)="store.isRendering.set(false)"
          (onRenderError)="store.renderError.set($event)"
        >
          <app-toolbar 
            controls 
            [themes]="store.themes" 
            [selectedTheme]="store.theme()" 
            [isRendering]="store.isRendering()"
            [disabledExport]="!!store.renderError() || !store.mermaidCode().trim()"
            (themeChange)="store.setTheme($event)"
            (openExport)="store.isExportModalOpen.set(true)"
          ></app-toolbar>
        </app-chart-preview>
      </div>
    </div>

    <footer class="text-center mt-8 text-slate-500 text-sm shrink-0">
      <p>Powered by Angular & Mermaid.js</p>
    </footer>
  </div>

  <!-- Modals -->
  <app-ai-modal 
    [isOpen]="store.isAiModalOpen()"
    [mode]="store.aiModalMode()"
    [currentCode]="store.mermaidCode()"
    (close)="store.isAiModalOpen.set(false)"
    (codeGenerated)="handleAiCode($event)"
  ></app-ai-modal>

  <app-example-modal
    [isOpen]="store.isExampleModalOpen()"
    [examples]="chartExamples"
    (close)="store.isExampleModalOpen.set(false)"
    (select)="handleExampleLoad($event)"
  ></app-example-modal>

  <app-export-modal
    [isOpen]="store.isExportModalOpen()"
    (close)="store.isExportModalOpen.set(false)"
    (confirm)="handleExport($event)"
  ></app-export-modal>
</main>
